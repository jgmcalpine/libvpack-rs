**Date:** January 31, 2026
**Scope:** Core Primitives Audit (Identity, Construction, Serialization)
**Targets:**
*   **Ark Labs:** `arkade-os/arkd`
*   **Second Technologies:** `ark-bitcoin/bark`

**Verdict:** The implementations are **Binary Incompatible** at the consensus level.
A vUTXO generated by Ark Labs cannot be verified by Second Technologies' libraries in its current form. However, the divergence is deterministic and configuration-based, meaning a middleware layer (V-PACK) can successfully bridge the two without requiring changes to the core consensus logic of either network.

## 2. Core Divergence Findings

### A. The Identity Crisis (Transaction Versioning)
The fundamental identifier of a Virtual UTXO (`VtxoId`) is derived from the SHA-256d hash of the virtual transaction. The two implementations construct this transaction differently, resulting in different IDs for the exact same asset.

| Feature | Ark Labs (`arkd`) | Second Tech (`bark`) | Impact |
| :--- | :--- | :--- | :--- |
| **TX Version** | `2` (Standard) | `3` (TRUC / V3 Relay) | **Critical.** The version is the first 4 bytes of the preimage. Hash mismatch guaranteed. |
| **LockTime** | `0` | `0` | **Compatible.** Both agree on zero-locktime. |
| **Source** | `ark-lib/intent/proof.go` | `lib/src/vtxo/genesis.rs` | |

**The Fix:** The V-PACK Header must include a `version_variant` byte. The `libvpack` verifier will use this byte to reconstruct the correct transaction preimage (V2 or V3) before hashing.

### B. The State Philosophy ("Receipt" vs. "Recipe")
The two systems use fundamentally different data models to prove the existence of a vUTXO.

*   **Ark Labs (The "Receipt" Model):**
    *   Stores the **Result**: `Vtxo { Outpoint, Amount, PubKey }`.
    *   Verification relies on the ASP's database to provide the link to the on-chain anchor. The client is a "Light Client."
    *   *Reference:* `internal/core/domain/vtxo.go`

*   **Second Tech (The "Recipe" Model):**
    *   Stores the **Instructions**: `Vtxo { GenesisItems[], Anchor }`.
    *   Verification is done by re-executing the "Recipe" (rebuilding the transaction tree locally) to see if it matches the `Outpoint`. The client is "Sovereign."
    *   *Reference:* `lib/src/vtxo/mod.rs`

**The Fix:** V-PACK must standardize on the **Recipe Model** (Second Tech) as it is the only one that allows offline/sovereign verification. Ark Labs adapters must be written to "inflate" their flat receipts into full genesis trees during the export process.

### C. Serialization & Typing
Wire formats differ, preventing direct byte-copying.

| Feature | Ark Labs | Second Tech | Impact |
| :--- | :--- | :--- | :--- |
| **Format** | Protobuf (`api-spec`) | Borsh (`serde`) | Requires transcoding. |
| **Primitives** | `string` (Hex) | `[u8; 32]` (Raw) | V-PACK must standardize on Raw Bytes to save space. |
| **Keys** | Compressed (33b) | X-Only (32b) | V-PACK must explicitly define key types in the Descriptor. |

## 3. The V-PACK Interoperability Strategy

Based on these findings, Project V-PACK defines the following requirements for the **V-BIP (Virtual-UTXO Binary Improvement Proposal)**:

1.  **The Container:** A defined binary format (using Borsh) that encapsulates the **Lowest Common Denominator** of data required by both protocols.
2.  **The Header:** Must contain:
    *   `magic_bytes`: `0x56504b` ("VPK")
    *   `consensus_version`: `0x02` (Legacy) or `0x03` (TRUC).
3.  **The Payload:** Must strictly follow the **Constructive Tree** format (The "Recipe").
    *   *Reason:* You can derive a Receipt from a Recipe, but you cannot derive a Recipe from a Receipt without external data.

## 4. Conclusion
The "Silo" effect is confirmed to be technical, not just political. However, no "Deal Breakers" (cryptographic incompatibilities) were found. The path to a universal standard requires a **Translation Layer**, which `libvpack-rs` will provide.
